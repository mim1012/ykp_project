<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>YKP ERP 기능 테스트</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6">
    <h1 class="text-3xl font-bold mb-6">🧪 YKP ERP 기능 정밀 테스트</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- 엑셀/고급 입력 테스트 -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4">📋 개통표 입력 링크 테스트</h2>
            <div class="space-y-2">
                <a href="/sales/excel-input" class="block bg-blue-500 text-white text-center py-2 rounded hover:bg-blue-600">
                    📤 엑셀 입력 테스트
                </a>
                <a href="/sales/advanced-input-pro" class="block bg-green-500 text-white text-center py-2 rounded hover:bg-green-600">
                    ⚙️ 고급 입력 테스트
                </a>
                <a href="/sales/complete-aggrid" class="block bg-purple-500 text-white text-center py-2 rounded hover:bg-purple-600">
                    📋 완전한 개통표 테스트
                </a>
            </div>
        </div>

        <!-- API 테스트 -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4">🔗 API 연결 테스트</h2>
            <div class="space-y-2">
                <button onclick="testStoresAPI()" class="block w-full bg-orange-500 text-white py-2 rounded hover:bg-orange-600">
                    🏪 매장 API 테스트
                </button>
                <button onclick="testBranchesAPI()" class="block w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
                    🏢 지사 API 테스트
                </button>
                <button onclick="testAccountsAPI()" class="block w-full bg-purple-500 text-white py-2 rounded hover:bg-purple-600">
                    👥 계정 API 테스트
                </button>
            </div>
            <div id="api-result" class="mt-4 p-3 bg-gray-100 rounded text-sm">
                API 테스트 결과가 여기에 표시됩니다.
            </div>
        </div>

        <!-- CSV 테스트 -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4">📤 CSV 내보내기 테스트</h2>
            <div class="space-y-2">
                <button onclick="testCSVExport()" class="block w-full bg-green-500 text-white py-2 rounded hover:bg-green-600">
                    📊 테스트 CSV 생성
                </button>
                <button onclick="testKoreanCSV()" class="block w-full bg-red-500 text-white py-2 rounded hover:bg-red-600">
                    🇰🇷 한글 CSV 테스트
                </button>
            </div>
            <div class="mt-4 text-sm text-gray-600">
                <p>• UTF-8 BOM 적용 여부 확인</p>
                <p>• 엑셀에서 한글 정상 표시 확인</p>
            </div>
        </div>

        <!-- 시스템 상태 -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4">⚡ 시스템 상태 확인</h2>
            <div class="space-y-2">
                <a href="/verify-accounts.php" class="block bg-gray-500 text-white text-center py-2 rounded hover:bg-gray-600">
                    👥 계정 현황 확인
                </a>
                <a href="/management/branches" class="block bg-blue-500 text-white text-center py-2 rounded hover:bg-blue-600">
                    🏢 지사 관리 페이지
                </a>
                <a href="/admin/accounts" class="block bg-purple-500 text-white text-center py-2 rounded hover:bg-purple-600">
                    👥 계정 관리 대시보드
                </a>
            </div>
        </div>
    </div>

    <script>
        async function testStoresAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = '🏪 매장 API 테스트 중...';
            
            try {
                const response = await fetch('/test-api/stores');
                const data = await response.json();
                
                result.innerHTML = `
                    <strong>✅ 매장 API 성공</strong><br>
                    총 매장 수: ${data.data?.length || 0}개<br>
                    응답 상태: ${response.status}<br>
                    데이터 샘플: ${data.data?.[0]?.name || '없음'}
                `;
            } catch (error) {
                result.innerHTML = `❌ 매장 API 실패: ${error.message}`;
            }
        }

        async function testBranchesAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = '🏢 지사 API 테스트 중...';
            
            try {
                const response = await fetch('/test-api/branches');
                const data = await response.json();
                
                result.innerHTML = `
                    <strong>✅ 지사 API 성공</strong><br>
                    총 지사 수: ${data.data?.length || 0}개<br>
                    응답 상태: ${response.status}<br>
                    데이터 샘플: ${data.data?.[0]?.name || '없음'}
                `;
            } catch (error) {
                result.innerHTML = `❌ 지사 API 실패: ${error.message}`;
            }
        }

        async function testAccountsAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = '👥 계정 API 테스트 중...';
            
            try {
                const response = await fetch('/test-api/accounts/all');
                
                if (response.status === 403) {
                    result.innerHTML = `⚠️ 계정 API: 403 Forbidden (인증 필요)<br>본사 계정으로 로그인 후 접근 가능`;
                    return;
                }
                
                const data = await response.json();
                result.innerHTML = `
                    <strong>✅ 계정 API 성공</strong><br>
                    총 계정 수: ${data.data?.length || 0}개<br>
                    응답 상태: ${response.status}
                `;
            } catch (error) {
                result.innerHTML = `❌ 계정 API 실패: ${error.message}`;
            }
        }

        function testCSVExport() {
            const testData = [
                ['이름', '이메일', '역할', '상태'],
                ['테스트사용자', 'test@ykp.com', '본사', '활성'],
                ['갤럭시사용자', 'galaxy@ykp.com', '지사', '활성'],
                ['부산김지사장', 'busan@ykp.com', '지사', '활성']
            ];
            
            const csvContent = testData.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `YKP_테스트_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            alert('📤 테스트 CSV 파일이 다운로드되었습니다!\n\n엑셀에서 열어서 한글이 정상 표시되는지 확인하세요.');
        }

        function testKoreanCSV() {
            const koreanData = [
                ['매장명', '모델명', '고객명', '메모'],
                ['부산해운대점', '갤럭시 S24 울트라', '홍길동', '신규 가입자, 용산점 추천'],
                ['서울강남점', 'iPhone 15 Pro', '김철수', '기존 고객, VIP 혜택'],
                ['대구중구점', '갤럭시 Z플립6', '이영희', 'MNP 고객, 프리미엄 플랜']
            ];
            
            const csvContent = koreanData.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `한글테스트_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            alert('📤 한글 CSV 파일이 다운로드되었습니다!\n\n이 파일을 엑셀에서 열었을 때:\n• 한글이 깨지지 않고 정상 표시되면 ✅ 성공\n• 한글이 깨져서 보이면 ❌ 실패');
        }
    </script>
</body>
</html>