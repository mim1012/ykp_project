import{r as e,R as t}from"./animations-Do808U0R.js";import{c as a}from"./client-C1IjpcXJ.js";import{A as l}from"./aggrid-BHWXp13O.js";import{u as r,b as n,c as o,Q as i,a as s}from"./query-NBleny6-.js";import{a as c}from"./utils-C-1G2k3o.js";import"./vendor-DEQ385Nk.js";const d=({dealerCode:a,readonly:i=!1,onRowsChanged:s})=>{const c=e.useRef(null),[d,p]=e.useState(null);r();const[g,v]=e.useState(!1),[y,h]=e.useState(""),[E,w]=e.useState(""),[N,x]=e.useState(!1),_=e.useRef(null),C=e.useRef(null);e.useEffect(()=>{const e=e=>{if(d){if(e.ctrlKey&&"z"===e.key&&e.preventDefault(),e.ctrlKey&&"y"===e.key&&e.preventDefault(),e.ctrlKey&&"s"===e.key){e.preventDefault();const t=[];d.forEachNode(e=>t.push(e.data)),T.mutate(t)}if("Delete"===e.key){d.getSelectedRows().length>0&&(e.preventDefault(),j())}"Insert"===e.key&&(e.preventDefault(),L()),e.ctrlKey&&"a"===e.key&&(e.preventDefault(),d.selectAll())}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e),_.current&&clearTimeout(_.current),C.current&&clearTimeout(C.current)}},[d,T]);const{data:S,isLoading:k}=o({queryKey:["sales",a],queryFn:()=>u(a),refetchOnWindowFocus:!1,staleTime:3e4}),R=n({mutationFn:e=>b(e,a),onMutate:()=>{v(!0),h("")},onSuccess:(e,t)=>{if(d){const a=d.getRowNode(t.id?.toString()||"");a&&(a.setData({...t,...e}),w("ê³„ì‚°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."),setTimeout(()=>w(""),2e3))}v(!1)},onError:e=>{h(`ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${e.message}`),v(!1),setTimeout(()=>h(""),5e3)}}),T=n({mutationFn:e=>f(e,a),onSuccess:()=>{x(!1),w("ìë™ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."),setTimeout(()=>w(""),2e3)},onError:e=>{h(`ìë™ ì €ì¥ ì‹¤íŒ¨: ${e.message}`),setTimeout(()=>h(""),5e3)}}),F=e.useMemo(()=>[{headerName:"íŒë§¤ì",field:"salesperson",editable:!i,width:100,pinned:"left"},{headerName:"ëŒ€ë¦¬ì ",field:"agency",editable:!i,width:100,cellEditor:"agSelectCellEditor",cellEditorParams:{values:["ì´ì•¤í‹°","ì•¤íˆ¬ìœˆ","ì´ˆì‹œëŒ€","ì•„ì— í‹°","ì—í”„ì§€"]}},{headerName:"í†µì‹ ì‚¬",field:"carrier",editable:!i,width:80,cellEditor:"agSelectCellEditor",cellEditorParams:{values:["SK","KT","LG"]}},{headerName:"ê°œí†µë°©ì‹",field:"activation_type",editable:!i,width:100,cellEditor:"agSelectCellEditor",cellEditorParams:{values:["ì‹ ê·œ","MNP","ê¸°ë³€"]}},{headerName:"ëª¨ë¸ëª…",field:"model_name",editable:!i,width:120},{headerName:"ì•¡ë©´/ì…‹íŒ…ê°€",field:"base_price",editable:!i,width:120,type:"numericColumn",cellEditor:"agNumberCellEditor",valueFormatter:e=>m(e.value),cellStyle:{backgroundColor:"#f0f8ff"}},{headerName:"êµ¬ë‘1",field:"verbal1",editable:!i,width:100,type:"numericColumn",cellEditor:"agNumberCellEditor",valueFormatter:e=>m(e.value),cellStyle:{backgroundColor:"#f0f8ff"}},{headerName:"êµ¬ë‘2",field:"verbal2",editable:!i,width:100,type:"numericColumn",cellEditor:"agNumberCellEditor",valueFormatter:e=>m(e.value),cellStyle:{backgroundColor:"#f0f8ff"}},{headerName:"ê·¸ë ˆì´ë“œ",field:"grade_amount",editable:!i,width:100,type:"numericColumn",cellEditor:"agNumberCellEditor",valueFormatter:e=>m(e.value),cellStyle:{backgroundColor:"#f0f8ff"}},{headerName:"ë¶€ê°€ì¶”ê°€",field:"additional_amount",editable:!i,width:100,type:"numericColumn",cellEditor:"agNumberCellEditor",valueFormatter:e=>m(e.value),cellStyle:{backgroundColor:"#f0f8ff"}},{headerName:"ë¦¬ë² ì´ê³„",field:"rebate_total",editable:!1,width:120,type:"numericColumn",valueFormatter:e=>m(e.value),cellStyle:{backgroundColor:"#fff2cc",fontWeight:"bold"}},{headerName:"ì •ì‚°ê¸ˆ",field:"settlement_amount",editable:!1,width:120,type:"numericColumn",valueFormatter:e=>m(e.value),cellStyle:{backgroundColor:"#fff2cc",fontWeight:"bold"}},{headerName:"ì„¸ê¸ˆ",field:"tax",editable:!1,width:100,type:"numericColumn",valueFormatter:e=>m(e.value),cellStyle:{backgroundColor:"#ffe6e6"}},{headerName:"ì„¸ì „ë§ˆì§„",field:"margin_before_tax",editable:!1,width:120,type:"numericColumn",valueFormatter:e=>m(e.value),cellStyle:{backgroundColor:"#e6ffe6",fontWeight:"bold"}},{headerName:"ì„¸í›„ë§ˆì§„",field:"margin_after_tax",editable:!1,width:120,type:"numericColumn",valueFormatter:e=>m(e.value),cellStyle:{backgroundColor:"#e6ffe6",fontWeight:"bold"},pinned:"right"}],[i]),D=e.useCallback(e=>{p(e.api),e.api.sizeColumnsToFit()},[]),M=e.useCallback(e=>{_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{const t={id:e.id,price_setting:e.base_price||0,verbal1:e.verbal1||0,verbal2:e.verbal2||0,grade_amount:e.grade_amount||0,addon_amount:e.additional_amount||0,paper_cash:e.cash_activation||0,usim_fee:e.usim_fee||0,new_mnp_disc:e.new_mnp_discount||0,deduction:e.deduction||0,cash_in:e.cash_received||0,payback:e.payback||0};R.mutate(t)},500)},[R]),K=e.useCallback(()=>{d&&(C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{const e=[];d.forEachNode(t=>e.push(t.data)),T.mutate(e)},3e3))},[d,T]),W=e.useCallback(e=>{const t=e.data;if(x(!0),M(t),K(),s&&d){const e=[];d.forEachNode(t=>e.push(t.data)),s(e)}},[M,K,s,d]),L=e.useCallback(()=>{if(!d)return;d.applyTransaction({add:[{salesperson:"",agency:"",carrier:"",activation_type:"",model_name:"",base_price:0,verbal1:0,verbal2:0,grade_amount:0,additional_amount:0,cash_activation:0,usim_fee:0,new_mnp_discount:0,deduction:0,cash_received:0,payback:0}]})},[d]),j=e.useCallback(()=>{if(!d)return;const e=d.getSelectedRows();d.applyTransaction({remove:e})},[d]);return t.createElement("div",{className:"w-full h-full"},!i&&t.createElement("div",{className:"mb-4 flex items-center justify-between bg-gray-50 p-4 rounded-lg"},t.createElement("div",{className:"flex gap-2"},t.createElement("button",{onClick:L,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors flex items-center gap-2"},t.createElement("span",null,"+")," í–‰ ì¶”ê°€ (Insert)"),t.createElement("button",{onClick:j,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors flex items-center gap-2"},t.createElement("span",null,"Ã—")," ì„ íƒ í–‰ ì‚­ì œ (Del)"),t.createElement("button",{onClick:()=>{if(d){const e=[];d.forEachNode(t=>e.push(t.data)),T.mutate(e)}},className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors flex items-center gap-2"},t.createElement("span",null,"ğŸ’¾")," ì €ì¥ (Ctrl+S)")),t.createElement("div",{className:"flex items-center gap-4"},g&&t.createElement("div",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm flex items-center gap-2"},t.createElement("div",{className:"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full"}),"ê³„ì‚° ì¤‘..."),N&&t.createElement("div",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm"},"ë¯¸ì €ì¥ ë³€ê²½ì‚¬í•­"),T.isPending&&t.createElement("div",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm"},"ìë™ ì €ì¥ ì¤‘..."))),t.createElement("div",{className:"mb-2"},E&&t.createElement("div",{className:"px-4 py-2 bg-green-100 text-green-800 rounded border-l-4 border-green-500 mb-2"},E),y&&t.createElement("div",{className:"px-4 py-2 bg-red-100 text-red-800 rounded border-l-4 border-red-500 mb-2"},y)),t.createElement("div",{className:"ag-theme-alpine",style:{height:"600px",width:"100%"}},t.createElement(l,{ref:c,rowData:S||[],columnDefs:F,onGridReady:D,onCellValueChanged:W,defaultColDef:{sortable:!0,filter:!0,resizable:!0,editable:!1,menuTabs:["filterMenuTab","generalMenuTab"],floatingFilter:!0},rowSelection:"multiple",suppressRowClickSelection:!0,rowMultiSelectWithClick:!1,editType:"fullRow",suppressClickEdit:!1,enterMovesDown:!0,enterMovesDownAfterEdit:!0,singleClickEdit:!0,stopEditingWhenCellsLoseFocus:!0,suppressRowDeselection:!1,enableCellTextSelection:!0,animateRows:!0,enableRangeSelection:!0,enableFillHandle:!0,enableRangeHandle:!0,suppressCopyRowsToClipboard:!1,suppressCopySingleCellRanges:!1,rowBuffer:10,debounceVerticalScrollbar:!0,suppressScrollOnNewData:!0,loading:k,loadingOverlayComponent:"agLoadingOverlay",suppressFieldDotNotation:!0,suppressMenuHide:!1,suppressMovableColumns:!1})))},m=e=>null==e?"":new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW"}).format(e),u=async e=>{try{const t=e?{dealer_code:e}:{};return(await c.get("/api/sales",{params:t})).data.data||[]}catch(t){return[{id:1,salesperson:"ê¹€ëŒ€ë¦¬",agency:"ENT",carrier:"SK",activation_type:"ì‹ ê·œ",model_name:"iPhone 15",base_price:1e5,verbal1:3e4,verbal2:2e4,grade_amount:15e3,additional_amount:5e3,rebate_total:17e4,settlement_amount:17e4,tax:22610,margin_before_tax:147390,margin_after_tax:17e4},{id:2,salesperson:"ë°•ê³¼ì¥",agency:"WIN",carrier:"KT",activation_type:"MNP",model_name:"Galaxy S24",base_price:15e4,verbal1:4e4,verbal2:25e3,grade_amount:2e4,additional_amount:1e4,rebate_total:245e3,settlement_amount:245e3,tax:32585,margin_before_tax:212415,margin_after_tax:245e3}]}},b=async(e,t)=>(await c.post("/api/calculation/row",{...e,dealer_code:t})).data.data,f=async(e,t)=>(await c.post("/api/sales/bulk-save",{data:e,dealer_code:t})).data,p=new i({defaultOptions:{queries:{refetchOnWindowFocus:!1,staleTime:3e5,retry:3,retryDelay:e=>Math.min(1e3*2**e,3e4)},mutations:{retry:1}}}),g=()=>{const[a,l]=e.useState(""),[r,n]=e.useState([]),[o,i]=e.useState({totalRows:0,modifiedRows:0,calculatingRows:0}),c=[{value:"",label:"ì „ì²´ ëŒ€ë¦¬ì ",color:"bg-gray-100"},{value:"ENT",label:"ì´ì•¤í‹°",color:"bg-blue-100"},{value:"WIN",label:"ì•¤íˆ¬ìœˆ",color:"bg-green-100"},{value:"CHOSI",label:"ì´ˆì‹œëŒ€",color:"bg-yellow-100"},{value:"AMT",label:"ì•„ì— í‹°",color:"bg-purple-100"},{value:"FG",label:"ì—í”„ì§€",color:"bg-pink-100"}];return t.createElement(s,{client:p},t.createElement("div",{className:"h-full flex flex-col"},t.createElement("div",{className:"bg-white border-b border-gray-200 p-6"},t.createElement("div",{className:"flex items-center justify-between mb-4"},t.createElement("div",null,t.createElement("h1",{className:"text-2xl font-bold text-gray-900"},"íŒë§¤ ê´€ë¦¬ ì‹œìŠ¤í…œ"),t.createElement("p",{className:"text-sm text-gray-600 mt-1"},"AgGrid ê¸°ë°˜ ì‹¤ì‹œê°„ ê³„ì‚° ë° ë°ì´í„° ê´€ë¦¬")),t.createElement("div",{className:"flex items-center space-x-4"},t.createElement("button",{onClick:()=>window.showShortcutHelp&&window.showShortcutHelp(),className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 flex items-center gap-2"},t.createElement("span",null,"?")," ë‹¨ì¶•í‚¤ (F1)"),t.createElement("div",{className:"text-right"},t.createElement("div",{className:"text-sm text-gray-500"},"í˜„ì¬ ì‹œê°„"),t.createElement("div",{className:"text-sm font-medium"},(new Date).toLocaleTimeString("ko-KR"))))),t.createElement("div",{className:"flex items-center justify-between"},t.createElement("div",{className:"flex items-center gap-4"},t.createElement("div",{className:"flex items-center gap-2"},t.createElement("label",{htmlFor:"dealer-select",className:"text-sm font-medium text-gray-700"},"ëŒ€ë¦¬ì  í•„í„°:"),t.createElement("select",{id:"dealer-select",value:a,onChange:e=>l(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},c.map(e=>t.createElement("option",{key:e.value,value:e.value},e.label)))),a&&t.createElement("div",{className:`px-3 py-1 rounded-full text-sm ${c.find(e=>e.value===a)?.color||"bg-gray-100"}`},c.find(e=>e.value===a)?.label," ì„ íƒë¨")),t.createElement("div",{className:"flex items-center gap-6 text-sm"},t.createElement("div",{className:"flex items-center gap-2"},t.createElement("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),t.createElement("span",null,"ì´ ",o.totalRows,"í–‰")),o.modifiedRows>0&&t.createElement("div",{className:"flex items-center gap-2"},t.createElement("div",{className:"w-3 h-3 bg-yellow-500 rounded-full animate-pulse"}),t.createElement("span",null,"ìˆ˜ì •ëœ í–‰: ",o.modifiedRows)),o.calculatingRows>0&&t.createElement("div",{className:"flex items-center gap-2"},t.createElement("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-spin"}),t.createElement("span",null,"ê³„ì‚° ì¤‘: ",o.calculatingRows))))),t.createElement("div",{className:"flex-1 p-6"},t.createElement("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 h-full"},t.createElement(d,{dealerCode:a,onRowsChanged:e=>{n(e),i(t=>({...t,totalRows:e.length,modifiedRows:e.filter(e=>e._modified).length}))}})))),!1)};document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sales-management-root");if(e)try{a.createRoot(e).render(t.createElement(g,null))}catch(l){e.innerHTML=`\n                <div class="p-4 bg-red-100 border border-red-400 rounded">\n                    <h3 class="font-bold text-red-800">AgGrid ë¡œë“œ ì‹¤íŒ¨</h3>\n                    <p class="text-red-600">React ì»´í¬ë„ŒíŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${l.message}</p>\n                </div>\n            `}}),window.AgGridUtils={formatCurrency:e=>null==e?"":new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW"}).format(e),validateRow:e=>{const t=[];return(!e.base_price||e.base_price<0)&&t.push("ì•¡ë©´ê°€ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤"),t}};
