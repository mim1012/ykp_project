<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª ì‹¤ì œ ë§¤ì¥ ê´€ë¦¬ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="csrf-token" content="test-token">
    <script src="/js/session-stability.js"></script>
</head>
<body class="bg-gray-50">
    <div class="max-w-7xl mx-auto py-6 px-4">
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-medium">ğŸ§ª ì‹¤ì œ ë§¤ì¥ ëª©ë¡ í…ŒìŠ¤íŠ¸</h2>
                    <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        â• ë§¤ì¥ ì¶”ê°€
                    </button>
                </div>
                <div id="stores-grid" class="bg-white rounded border">
                    <div class="p-4 text-center text-gray-500">ë§¤ì¥ ë°ì´í„° ë¡œë”© ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ğŸš€ ì‹¤ì œ ë§¤ì¥ ë°ì´í„° ë¡œë“œ ë° ë²„íŠ¼ í…ŒìŠ¤íŠ¸
        async function loadRealStores() {
            console.log('ğŸ”„ ì‹¤ì œ ë§¤ì¥ ë°ì´í„° ë¡œë“œ');
            
            try {
                const response = await fetch('/api/dev/stores/list');
                const data = await response.json();
                
                if (data.success && data.data) {
                    console.log('âœ… ë§¤ì¥ ë°ì´í„° ë¡œë“œë¨:', data.data.length + 'ê°œ');
                    
                    // ì§€ì‚¬ë³„ ê·¸ë£¹í™”
                    const storesByBranch = {};
                    data.data.forEach(store => {
                        const branchName = store.branch?.name || 'ë¯¸ë°°ì • ì§€ì‚¬';
                        if (!storesByBranch[branchName]) {
                            storesByBranch[branchName] = [];
                        }
                        storesByBranch[branchName].push(store);
                    });
                    
                    // HTML ìƒì„± (ì‹¤ì œ ë§¤ì¥ ê´€ë¦¬ì™€ ë™ì¼í•œ êµ¬ì¡°)
                    let html = `<div class="space-y-6">`;
                    
                    Object.entries(storesByBranch).forEach(([branchName, stores]) => {
                        html += `
                            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                                <div class="bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4">
                                    <h3 class="text-xl font-bold text-white">ğŸ¢ ${branchName} (${stores.length}ê°œ ë§¤ì¥)</h3>
                                </div>
                                <div class="p-6">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        `;
                        
                        stores.forEach(store => {
                            html += `
                                <div class="bg-gray-50 rounded-lg p-4 hover:bg-white hover:shadow-md transition-all border">
                                    <div class="flex justify-between items-start mb-3">
                                        <h4 class="font-bold text-lg">${store.name}</h4>
                                        <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">âœ… ìš´ì˜ì¤‘</span>
                                    </div>
                                    <div class="text-sm text-gray-600 space-y-1 mb-3">
                                        <p><span class="font-medium">ì½”ë“œ:</span> ${store.code}</p>
                                        <p><span class="font-medium">ì ì£¼:</span> ${store.owner_name || 'ë¯¸ë“±ë¡'}</p>
                                        <p><span class="font-medium">ì—°ë½ì²˜:</span> ${store.phone || 'ë¯¸ë“±ë¡'}</p>
                                    </div>
                                    
                                    <div class="mt-3 flex gap-2">
                                        <button data-store-id="${store.id}" data-store-name="${store.name}" class="store-edit-btn px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">âœï¸ ìˆ˜ì •</button>
                                        <button data-store-id="${store.id}" data-store-name="${store.name}" class="store-account-btn px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600">ğŸ‘¤ ê³„ì •</button>
                                        <button data-store-id="${store.id}" data-store-name="${store.name}" class="store-stats-btn px-3 py-1 bg-purple-500 text-white text-xs rounded hover:bg-purple-600">ğŸ“Š ì„±ê³¼</button>
                                        <button data-store-id="${store.id}" data-store-name="${store.name}" class="store-delete-btn px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">ğŸ—‘ï¸ ì‚­ì œ</button>
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    document.getElementById('stores-grid').innerHTML = html;
                    
                    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                    setupStoreButtons();
                    
                } else {
                    document.getElementById('stores-grid').innerHTML = '<div class="p-4 text-center text-red-500">ë§¤ì¥ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>';
                }
            } catch (error) {
                console.error('ë§¤ì¥ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('stores-grid').innerHTML = '<div class="p-4 text-center text-red-500">ì˜¤ë¥˜: ' + error.message + '</div>';
            }
        }
        
        // ğŸ› ï¸ ë§¤ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì • (ì‹¤ì œ ì½”ë“œì™€ ë™ì¼)
        function setupStoreButtons() {
            console.log('ğŸ› ï¸ ë§¤ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡');
            
            document.addEventListener('click', function(e) {
                const target = e.target;
                const storeId = target.dataset.storeId;
                const storeName = target.dataset.storeName;
                
                if (!storeId) return;
                
                if (target.classList.contains('store-edit-btn')) {
                    console.log('âœï¸ ìˆ˜ì • í´ë¦­:', storeId, storeName);
                    alert(`ë§¤ì¥ ìˆ˜ì •: ${storeName} (ID: ${storeId})\n\nì‹¤ì œ í™˜ê²½ì—ì„œëŠ” í¸ì§‘ ëª¨ë‹¬ì´ ì—´ë¦½ë‹ˆë‹¤.`);
                    
                } else if (target.classList.contains('store-account-btn')) {
                    console.log('ğŸ‘¤ ê³„ì • í´ë¦­:', storeId, storeName);
                    if (confirm(`${storeName} ë§¤ì¥ì˜ ì§ì› ê³„ì •ì„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        alert('âœ… ê³„ì • ìƒì„± ê¸°ëŠ¥ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.');
                    }
                    
                } else if (target.classList.contains('store-stats-btn')) {
                    console.log('ğŸ“Š ì„±ê³¼ í´ë¦­:', storeId, storeName);
                    alert(`${storeName} ë§¤ì¥ ì„±ê³¼ ë¶„ì„\n\nâ€¢ ì›” ë§¤ì¶œ í˜„í™©\nâ€¢ ê°œí†µ ì‹¤ì \nâ€¢ ëª©í‘œ ë‹¬ì„±ë¥ \n\nì„±ê³¼ ëŒ€ì‹œë³´ë“œê°€ ì—´ë¦½ë‹ˆë‹¤.`);
                    
                } else if (target.classList.contains('store-delete-btn')) {
                    console.log('ğŸ—‘ï¸ ì‚­ì œ í´ë¦­:', storeId, storeName);
                    if (confirm(`âš ï¸ ì •ë§ë¡œ "${storeName}" ë§¤ì¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œ ì‹œ:\nâ€¢ ë§¤ì¥ ì •ë³´ ì™„ì „ ì‚­ì œ\nâ€¢ ê´€ë ¨ ê³„ì • ë¹„í™œì„±í™”\nâ€¢ ì •ì‚° ë°ì´í„° ë³´ê´€\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                        alert('ğŸ—‘ï¸ ë§¤ì¥ ì‚­ì œ APIê°€ í˜¸ì¶œë©ë‹ˆë‹¤.\n(í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œëŠ” ì‹¤ì œ ì‚­ì œ ì•ˆí•¨)');
                    }
                }
            });
            
            console.log('âœ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
        }
        
        // ìë™ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ì‹¤ì œ ë§¤ì¥ ë°ì´í„° ë¡œë“œ');
            loadRealStores();
        });
    </script>
</body>
</html>