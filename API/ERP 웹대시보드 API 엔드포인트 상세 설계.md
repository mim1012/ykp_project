# ERP 웹대시보드 API 엔드포인트 상세 설계

## 개요

본 문서는 25년1월정산.xlsx 파일 분석을 바탕으로 설계된 ERP 웹대시보드의 API 엔드포인트 상세 설계를 다룹니다. 일일지출, 고정지출, 환수금액, 직원급여, 월마감정산, 대리점별 정산금 등의 핵심 비즈니스 데이터를 효율적으로 관리하고 조회할 수 있는 RESTful API 구조를 제시합니다.

분석 결과 총 7개의 핵심 데이터 모델과 44개의 API 엔드포인트가 설계되었으며, 이는 현재 엑셀 기반 업무 프로세스를 완전히 디지털화하고 실시간 데이터 처리가 가능한 웹 기반 시스템으로 전환하는 것을 목표로 합니다.

## API 아키텍처 설계

### 전체 구조

ERP 웹대시보드 API는 마이크로서비스 아키텍처를 기반으로 설계되었으며, 각 비즈니스 도메인별로 독립적인 서비스 모듈을 구성합니다. 이러한 구조는 확장성과 유지보수성을 극대화하면서도 각 모듈 간의 느슨한 결합을 통해 시스템의 안정성을 보장합니다.

API 설계의 핵심 원칙은 RESTful 아키텍처를 준수하면서도 비즈니스 요구사항에 최적화된 엔드포인트를 제공하는 것입니다. 모든 엔드포인트는 HTTP 표준 메서드(GET, POST, PUT, DELETE)를 사용하며, 일관된 응답 형식과 오류 처리 메커니즘을 제공합니다.

### 인증 및 보안

API 보안은 JWT(JSON Web Token) 기반 인증 시스템을 사용하여 구현됩니다. 모든 API 요청은 Authorization 헤더에 유효한 JWT 토큰을 포함해야 하며, 토큰에는 사용자의 권한 정보와 대리점 코드가 포함되어 사용자별 데이터 접근 제어가 가능합니다.

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

권한 체계는 다음과 같이 구성됩니다:
- **admin**: 모든 대리점 데이터 접근 및 시스템 설정 관리
- **manager**: 특정 대리점 그룹의 데이터 접근 및 관리
- **dealer**: 자신의 대리점 데이터만 접근 가능
- **viewer**: 읽기 전용 접근 권한

### 응답 형식 표준화

모든 API 응답은 다음과 같은 표준화된 형식을 따릅니다:

```json
{
  "success": true,
  "data": {
    // 실제 데이터
  },
  "meta": {
    "timestamp": "2024-12-21T10:30:00Z",
    "version": "1.0",
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 150,
      "pages": 8
    }
  },
  "errors": []
}
```

오류 응답의 경우:

```json
{
  "success": false,
  "data": null,
  "meta": {
    "timestamp": "2024-12-21T10:30:00Z",
    "version": "1.0"
  },
  "errors": [
    {
      "code": "VALIDATION_ERROR",
      "message": "필수 필드가 누락되었습니다",
      "field": "dealer_code"
    }
  ]
}
```

## 핵심 API 엔드포인트 상세 설계

### 1. 개통 데이터 API (Activations)

개통 데이터 API는 ERP 시스템의 핵심 트랜잭션 데이터를 관리하는 가장 중요한 엔드포인트입니다. 현재 엑셀의 "개통표" 시트에 해당하는 모든 기능을 디지털화하여 제공합니다.

#### 1.1 기본 CRUD 엔드포인트

**개통 목록 조회**
```
GET /api/activations
```

이 엔드포인트는 개통 데이터의 목록을 페이지네이션과 함께 제공합니다. 다양한 필터링 옵션을 지원하여 사용자가 원하는 조건에 맞는 데이터를 효율적으로 조회할 수 있습니다.

쿼리 파라미터:
- `page`: 페이지 번호 (기본값: 1)
- `limit`: 페이지당 항목 수 (기본값: 20, 최대: 100)
- `dealer_code`: 대리점 코드 필터
- `start_date`: 개통일 시작 범위 (YYYY-MM-DD)
- `end_date`: 개통일 종료 범위 (YYYY-MM-DD)
- `carrier`: 통신사 필터 (SK, KT, LG)
- `activation_type`: 개통방식 필터 (신규, MNP, 기변)
- `sort`: 정렬 기준 (activation_date, settlement_amount 등)
- `order`: 정렬 순서 (asc, desc)

응답 예시:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "dealer_code": "ENT",
      "dealer_name": "이앤티",
      "carrier": "SK",
      "activation_type": "신규",
      "model_name": "갤럭시 S24",
      "activation_date": "2024-01-15",
      "customer_name": "홍길동",
      "customer_phone": "010-1234-5678",
      "face_value": 500000,
      "verbal1": 20000,
      "verbal2": 10000,
      "total_rebate": 530000,
      "settlement_amount": 330000,
      "tax_amount": 43890,
      "pre_tax_margin": 286110,
      "post_tax_margin": 242220
    }
  ],
  "meta": {
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 150,
      "pages": 8
    }
  }
}
```

**개통 단건 조회**
```
GET /api/activations/{id}
```

특정 개통 건의 상세 정보를 조회합니다. 모든 필드 정보와 함께 관련된 환수 내역이 있는 경우 해당 정보도 포함하여 제공합니다.

**개통 데이터 생성**
```
POST /api/activations
```

새로운 개통 건을 등록합니다. 요청 본문에는 필수 필드들이 포함되어야 하며, 서버에서 자동으로 계산되는 필드들(총 리베이트, 정산금, 세금, 마진 등)은 실시간으로 계산되어 저장됩니다.

요청 본문 예시:
```json
{
  "dealer_code": "ENT",
  "carrier": "SK",
  "activation_type": "신규",
  "model_name": "갤럭시 S24",
  "activation_date": "2024-01-15",
  "customer_name": "홍길동",
  "customer_phone": "010-1234-5678",
  "face_value": 500000,
  "verbal1": 20000,
  "verbal2": 10000,
  "grade_amount": 15000,
  "additional1": 5000,
  "document_cash": 200000,
  "sim_fee": 0,
  "mnp_discount": 800,
  "cash_received": 50000,
  "payback_amount": 10000
}
```

#### 1.2 특별 기능 엔드포인트

**대리점별 개통 내역 조회**
```
GET /api/activations/by-dealer/{dealer_code}
```

특정 대리점의 개통 내역을 조회합니다. 기간별 필터링과 함께 해당 대리점의 성과 지표도 함께 제공합니다.

**월별 개통 현황 요약**
```
GET /api/activations/monthly-summary
```

월별 개통 현황을 요약하여 제공합니다. 대리점별, 통신사별, 개통방식별 집계 데이터를 포함하며, 전월 대비 증감률과 목표 달성률 정보도 함께 제공합니다.

응답 예시:
```json
{
  "success": true,
  "data": {
    "year_month": "2024-01",
    "total_activations": 150,
    "total_settlement": 45000000,
    "average_margin": 16.8,
    "by_dealer": [
      {
        "dealer_code": "ENT",
        "dealer_name": "이앤티",
        "activations": 44,
        "settlement_amount": 14520000,
        "margin_rate": 18.2
      }
    ],
    "by_carrier": [
      {
        "carrier": "SK",
        "activations": 80,
        "percentage": 53.3
      }
    ],
    "trends": {
      "previous_month_change": 12.5,
      "target_achievement": 95.2
    }
  }
}
```

**개통 데이터 대량 등록**
```
POST /api/activations/bulk-import
```

엑셀 파일이나 CSV 파일에서 추출한 대량의 개통 데이터를 한 번에 등록할 수 있습니다. 데이터 검증과 중복 체크를 수행하며, 오류가 있는 행에 대한 상세한 피드백을 제공합니다.

### 2. 일일지출 API (Daily Expenses)

일일지출 API는 대리점의 일상적인 운영비용을 관리하는 엔드포인트입니다. 상담비, 메일접수비, 기타 운영비 등을 체계적으로 관리할 수 있습니다.

#### 2.1 기본 CRUD 엔드포인트

**일일지출 목록 조회**
```
GET /api/daily-expenses
```

일일지출 내역을 날짜별, 대리점별, 카테고리별로 조회할 수 있습니다. 월별 집계 정보와 함께 예산 대비 지출 현황도 제공합니다.

쿼리 파라미터:
- `expense_date`: 지출일 (YYYY-MM-DD)
- `dealer_code`: 대리점 코드
- `category`: 지출 카테고리 (상담비, 메일접수비, 기타)
- `start_date`, `end_date`: 기간 범위
- `min_amount`, `max_amount`: 금액 범위

**일일지출 등록**
```
POST /api/daily-expenses
```

새로운 일일지출 항목을 등록합니다. 영수증 번호와 승인자 정보를 포함하여 투명한 지출 관리가 가능합니다.

요청 본문 예시:
```json
{
  "expense_date": "2024-01-15",
  "dealer_code": "ENT",
  "category": "상담비",
  "description": "고객 상담 인센티브",
  "amount": 50000,
  "payment_method": "현금",
  "receipt_number": "RCP-2024-001",
  "approved_by": "김점장"
}
```

#### 2.2 집계 및 분석 엔드포인트

**월별 지출 현황**
```
GET /api/daily-expenses/monthly-summary
```

월별 지출 현황을 카테고리별로 집계하여 제공합니다. 예산 대비 지출률과 전월 대비 증감률 정보도 포함합니다.

**지출 트렌드 분석**
```
GET /api/daily-expenses/trends
```

지출 패턴과 트렌드를 분석하여 제공합니다. 요일별, 월별 지출 패턴과 이상 지출 감지 기능을 포함합니다.

### 3. 고정지출 API (Fixed Expenses)

고정지출 API는 임대료, 인건비, 통신비 등 정기적으로 발생하는 고정비용을 관리합니다.

#### 3.1 기본 관리 기능

**고정지출 목록 조회**
```
GET /api/fixed-expenses
```

월별 고정지출 내역을 조회합니다. 지출 유형별 분류와 지급 상태 정보를 포함합니다.

**고정지출 등록**
```
POST /api/fixed-expenses
```

새로운 고정지출 항목을 등록합니다. 지급 예정일과 실제 지급일을 관리하여 현금 흐름 예측이 가능합니다.

#### 3.2 지급 관리 기능

**지급 상태 업데이트**
```
PUT /api/fixed-expenses/{id}/payment-status
```

고정지출 항목의 지급 상태를 업데이트합니다. 지급 완료 시 실제 지급일과 지급 방법을 기록합니다.

**지급 예정 내역**
```
GET /api/fixed-expenses/upcoming-payments
```

향후 지급 예정인 고정지출 내역을 조회합니다. 현금 흐름 관리와 자금 계획 수립에 활용됩니다.

### 4. 환수금액 API (Refunds)

환수금액 API는 고객 환불이나 통신사 환수 등으로 인한 손실을 관리합니다.

#### 4.1 환수 관리 기능

**환수 내역 조회**
```
GET /api/refunds
```

환수 내역을 조회합니다. 원인별, 대리점별 분류와 함께 환수율 통계를 제공합니다.

**환수 등록**
```
POST /api/refunds
```

새로운 환수 건을 등록합니다. 원래 개통 건과 연결하여 추적 가능성을 확보합니다.

요청 본문 예시:
```json
{
  "refund_date": "2024-01-20",
  "dealer_code": "ENT",
  "activation_id": 123,
  "customer_name": "홍길동",
  "customer_phone": "010-1234-5678",
  "refund_reason": "단순변심",
  "refund_type": "전액환불",
  "original_amount": 500000,
  "refund_amount": 500000,
  "penalty_amount": 50000,
  "refund_method": "현금"
}
```

#### 4.2 환수 분석 기능

**환수율 분석**
```
GET /api/refunds/analysis
```

환수율 분석 데이터를 제공합니다. 대리점별, 모델별, 기간별 환수율과 주요 환수 원인을 분석합니다.

### 5. 직원급여 API (Payroll)

직원급여 API는 대리점 직원들의 급여 정보를 관리합니다.

#### 5.1 급여 관리 기능

**급여 내역 조회**
```
GET /api/payroll
```

월별 급여 내역을 조회합니다. 직원별, 직급별 급여 정보와 인센티브 내역을 포함합니다.

**급여 등록**
```
POST /api/payroll
```

월별 급여 정보를 등록합니다. 기본급, 인센티브, 보너스, 공제액을 포함한 상세 급여 정보를 관리합니다.

#### 5.2 급여 계산 기능

**인센티브 자동 계산**
```
POST /api/payroll/calculate-incentives
```

개통 실적을 바탕으로 직원별 인센티브를 자동 계산합니다. 대리점별 인센티브 정책을 적용하여 정확한 계산을 수행합니다.

### 6. 월마감정산 API (Monthly Settlements)

월마감정산 API는 월별 종합 정산 정보를 관리하는 핵심 엔드포인트입니다.

#### 6.1 정산 생성 및 관리

**월별 정산 자동 생성**
```
POST /api/monthly-settlements/generate/{year_month}
```

지정된 월의 모든 데이터를 집계하여 월별 정산을 자동 생성합니다. 개통 수익, 각종 지출, 환수 손실 등을 종합하여 최종 정산 금액을 계산합니다.

처리 과정:
1. 해당 월의 모든 개통 데이터 집계
2. 일일지출 및 고정지출 합계 계산
3. 환수 금액 차감
4. 직원 급여 차감
5. 세금 계산
6. 최종 순이익 산출

**정산 확정**
```
PUT /api/monthly-settlements/{id}/confirm
```

월별 정산을 확정합니다. 확정된 정산은 수정이 제한되며, 회계 시스템과의 연동을 위한 데이터로 활용됩니다.

#### 6.2 정산 조회 및 분석

**월별 정산 대시보드**
```
GET /api/monthly-settlements/dashboard/{year_month}
```

월별 정산 현황을 대시보드 형태로 제공합니다. 주요 KPI와 전월 대비 증감률, 목표 달성률 등을 포함합니다.

응답 예시:
```json
{
  "success": true,
  "data": {
    "year_month": "2024-01",
    "summary": {
      "total_activations": 150,
      "gross_revenue": 50000000,
      "total_expenses": 8169200,
      "net_profit": 41830800,
      "profit_margin": 83.7
    },
    "revenue_breakdown": {
      "settlement_amount": 45000000,
      "cash_received": 3000000,
      "payback_amount": 2000000
    },
    "expense_breakdown": {
      "daily_expenses": 2000000,
      "fixed_expenses": 3000000,
      "refunds": 500000,
      "payroll": 2669200
    },
    "dealer_performance": [
      {
        "dealer_code": "ENT",
        "dealer_name": "이앤티",
        "activations": 44,
        "revenue": 14520000,
        "profit": 12850800
      }
    ]
  }
}
```

### 7. 대리점별정산금 API (Dealer Settlement Details)

대리점별정산금 API는 각 대리점과의 정산 내역을 상세히 관리합니다.

#### 7.1 정산 비교 기능

**정산 내역 비교**
```
GET /api/dealer-settlement-details/compare/{year_month}
```

내부 정산서와 대리점 정산서를 비교하여 차액을 분석합니다. 불일치 항목에 대한 상세 분석과 조정 방안을 제시합니다.

**차액 조정**
```
PUT /api/dealer-settlement-details/{id}/reconcile
```

정산 차액에 대한 조정을 수행합니다. 조정 사유와 승인자 정보를 기록하여 투명한 정산 관리를 지원합니다.

## 통합 대시보드 API

### 전체 현황 요약

**대시보드 개요**
```
GET /api/dashboard/overview
```

전체 시스템의 핵심 지표를 요약하여 제공합니다. 실시간 데이터 업데이트를 통해 최신 현황을 파악할 수 있습니다.

**대리점별 성과 분석**
```
GET /api/dashboard/dealer-performance
```

대리점별 성과를 다각도로 분석하여 제공합니다. 수익성, 효율성, 성장성 지표를 포함한 종합 평가를 수행합니다.

**재무 현황 요약**
```
GET /api/dashboard/financial-summary
```

재무 현황을 요약하여 제공합니다. 현금 흐름, 수익성 분석, 비용 구조 분석 등을 포함합니다.

## API 성능 최적화

### 캐싱 전략

자주 조회되는 데이터에 대해서는 Redis 기반 캐싱을 적용하여 응답 속도를 향상시킵니다. 특히 대시보드 데이터와 집계 정보는 5분 단위로 캐시를 갱신하여 실시간성과 성능을 균형있게 유지합니다.

### 데이터베이스 최적화

복잡한 집계 쿼리의 성능을 위해 적절한 인덱스를 설정하고, 필요한 경우 구체화된 뷰(Materialized View)를 활용합니다. 특히 월별 정산과 같은 대용량 데이터 처리에서는 배치 처리와 비동기 처리를 적용합니다.

### 페이지네이션 및 필터링

모든 목록 조회 API는 효율적인 페이지네이션을 지원하며, 다양한 필터링 옵션을 제공하여 사용자가 필요한 데이터만 빠르게 조회할 수 있도록 합니다.

## 오류 처리 및 로깅

### 표준화된 오류 코드

모든 API는 표준화된 오류 코드를 사용하여 일관된 오류 처리를 제공합니다:

- `VALIDATION_ERROR`: 입력 데이터 검증 오류
- `AUTHENTICATION_ERROR`: 인증 실패
- `AUTHORIZATION_ERROR`: 권한 부족
- `NOT_FOUND`: 리소스를 찾을 수 없음
- `BUSINESS_LOGIC_ERROR`: 비즈니스 로직 오류
- `SYSTEM_ERROR`: 시스템 내부 오류

### 상세 로깅

모든 API 요청과 응답은 상세히 로깅되며, 오류 발생 시 디버깅을 위한 충분한 정보를 제공합니다. 개인정보는 마스킹 처리하여 보안을 유지합니다.

## API 문서화 및 테스트

### Swagger/OpenAPI 문서

모든 API는 Swagger/OpenAPI 3.0 표준에 따라 문서화되며, 대화형 API 문서를 통해 개발자가 쉽게 테스트하고 이해할 수 있도록 합니다.

### 자동화된 테스트

각 API 엔드포인트에 대한 단위 테스트와 통합 테스트를 구현하여 코드 품질과 안정성을 보장합니다. CI/CD 파이프라인과 연동하여 자동화된 테스트를 수행합니다.

이러한 종합적인 API 설계를 통해 현재의 엑셀 기반 업무 프로세스를 완전히 디지털화하고, 실시간 데이터 처리와 분석이 가능한 현대적인 ERP 시스템을 구축할 수 있습니다.


## API 연동 가이드 및 구현 방안

### 단계별 구현 로드맵

ERP 웹대시보드 API의 성공적인 구현을 위해서는 체계적이고 단계적인 접근이 필요합니다. 현재 엑셀 기반 업무 프로세스에서 완전한 디지털 시스템으로의 전환은 복잡한 과정이므로, 위험을 최소화하면서도 효과를 극대화할 수 있는 점진적 구현 전략을 제시합니다.

#### Phase 1: 기반 인프라 구축 (4-6주)

첫 번째 단계에서는 전체 시스템의 기반이 되는 핵심 인프라를 구축합니다. 이 단계는 향후 모든 기능 개발의 토대가 되므로 안정성과 확장성을 최우선으로 고려해야 합니다.

**데이터베이스 스키마 구축**

분석된 7개 핵심 테이블의 데이터베이스 스키마를 구축합니다. MySQL 8.0 이상을 권장하며, 다음과 같은 순서로 테이블을 생성합니다:

1. `dealer_profiles` - 대리점 기본 정보 및 설정
2. `activations` - 개통 데이터 (핵심 트랜잭션 테이블)
3. `daily_expenses` - 일일 지출 내역
4. `fixed_expenses` - 고정 지출 내역
5. `refunds` - 환수 금액 내역
6. `payroll` - 직원 급여 내역
7. `monthly_settlements` - 월별 마감 정산
8. `dealer_settlement_details` - 대리점별 상세 정산

각 테이블에는 적절한 인덱스를 설정하여 쿼리 성능을 최적화합니다. 특히 날짜 기반 조회가 빈번한 `activation_date`, `expense_date` 등의 컬럼과 대리점별 필터링을 위한 `dealer_code` 컬럼에는 복합 인덱스를 적용합니다.

**API 서버 기본 구조 구축**

Flask 기반의 RESTful API 서버를 구축합니다. 다음과 같은 기본 구조를 권장합니다:

```
erp_api/
├── app/
│   ├── __init__.py
│   ├── models/
│   │   ├── __init__.py
│   │   ├── activation.py
│   │   ├── expense.py
│   │   ├── refund.py
│   │   ├── payroll.py
│   │   └── settlement.py
│   ├── api/
│   │   ├── __init__.py
│   │   ├── activations.py
│   │   ├── expenses.py
│   │   ├── refunds.py
│   │   ├── payroll.py
│   │   ├── settlements.py
│   │   └── dashboard.py
│   ├── utils/
│   │   ├── __init__.py
│   │   ├── auth.py
│   │   ├── validation.py
│   │   └── calculations.py
│   └── config.py
├── migrations/
├── tests/
├── requirements.txt
└── run.py
```

**인증 및 보안 시스템**

JWT 기반 인증 시스템을 구현합니다. 사용자 권한은 4단계(admin, manager, dealer, viewer)로 구분하며, 각 API 엔드포인트에 적절한 권한 검사를 적용합니다. 모든 민감한 데이터는 암호화하여 저장하고, API 통신은 HTTPS를 통해서만 허용합니다.

#### Phase 2: 핵심 기능 개발 (6-8주)

두 번째 단계에서는 비즈니스 핵심 기능인 개통 데이터 관리와 기본적인 지출 관리 기능을 구현합니다.

**개통 데이터 API 구현**

개통 데이터는 전체 시스템의 핵심이므로 가장 먼저 구현합니다. 다음 기능들을 포함합니다:

- 개통 데이터 CRUD 기본 기능
- 실시간 마진 계산 로직
- 대량 데이터 입력 기능 (엑셀 업로드)
- 기본적인 필터링 및 검색 기능
- 월별 집계 기능

실시간 마진 계산은 특히 중요한 기능으로, 사용자가 데이터를 입력하는 즉시 정확한 정산금과 마진을 계산하여 표시해야 합니다. 이를 위해 다음과 같은 계산 로직을 구현합니다:

```python
def calculate_settlement_amounts(activation_data):
    """개통 데이터의 정산 금액들을 계산"""
    
    # 리베총계 = 액면가 + 구두1 + 구두2 + 구두3 + 구두4 + 부가1 + 부가2 + 그레이드
    total_rebate = (
        activation_data.get('face_value', 0) +
        activation_data.get('verbal1', 0) +
        activation_data.get('verbal2', 0) +
        activation_data.get('verbal3', 0) +
        activation_data.get('verbal4', 0) +
        activation_data.get('additional1', 0) +
        activation_data.get('additional2', 0) +
        activation_data.get('grade_amount', 0)
    )
    
    # 정산금 = 리베총계 - 서류상현금 + 유심비 + 신규번이할인 + 차감금액
    settlement_amount = (
        total_rebate -
        activation_data.get('document_cash', 0) +
        activation_data.get('sim_fee', 0) +
        activation_data.get('mnp_discount', 0) +
        activation_data.get('deduction_amount', 0)
    )
    
    # 세금 = 정산금 × 13.3%
    tax_amount = settlement_amount * 0.133
    
    # 세전마진 = 정산금 - 세금 + 현금받음 + 페이백
    pre_tax_margin = (
        settlement_amount - tax_amount +
        activation_data.get('cash_received', 0) +
        activation_data.get('payback_amount', 0)
    )
    
    # 세후마진 = 세전마진 (현재 로직에서는 동일)
    post_tax_margin = pre_tax_margin
    
    return {
        'total_rebate': total_rebate,
        'settlement_amount': settlement_amount,
        'tax_amount': tax_amount,
        'pre_tax_margin': pre_tax_margin,
        'post_tax_margin': post_tax_margin
    }
```

**지출 관리 API 구현**

일일지출과 고정지출 관리 기능을 구현합니다. 지출 카테고리별 분류와 승인 워크플로우를 포함하여 투명한 지출 관리가 가능하도록 합니다.

#### Phase 3: 고급 기능 및 분석 (4-6주)

세 번째 단계에서는 환수 관리, 급여 관리, 그리고 고급 분석 기능을 구현합니다.

**환수 및 급여 관리**

환수 관리는 원래 개통 건과의 연결성을 중시하여 구현합니다. 환수 발생 시 해당 개통 건의 수익성에 미치는 영향을 실시간으로 계산하고 표시합니다.

급여 관리는 개통 실적 기반 인센티브 자동 계산 기능을 포함합니다. 대리점별로 다른 인센티브 정책을 적용할 수 있도록 유연한 구조로 설계합니다.

**고급 분석 및 리포팅**

비즈니스 인텔리전스 기능을 구현합니다. 다음과 같은 분석 기능을 제공합니다:

- 대리점별 성과 비교 분석
- 수익성 트렌드 분석
- 비용 구조 분석
- 예측 분석 (매출 예측, 비용 예측)
- 이상 거래 탐지

#### Phase 4: 통합 및 최적화 (4-6주)

마지막 단계에서는 월별 정산 자동화와 전체 시스템 통합을 완료합니다.

**월별 정산 자동화**

월별 정산은 모든 데이터를 종합하는 핵심 기능입니다. 다음과 같은 자동화 프로세스를 구현합니다:

1. 월말 자동 정산 트리거
2. 모든 수익 및 비용 데이터 집계
3. 대리점별 상세 정산 생성
4. 차액 분석 및 조정 제안
5. 최종 정산 확정 및 보고서 생성

**성능 최적화 및 모니터링**

시스템 성능을 최적화하고 모니터링 체계를 구축합니다. Redis 캐싱, 데이터베이스 쿼리 최적화, API 응답 시간 모니터링 등을 포함합니다.

### 기술 스택 및 아키텍처

#### 백엔드 기술 스택

**웹 프레임워크**: Flask 2.3+
Flask는 가볍고 유연한 웹 프레임워크로, ERP 시스템과 같은 복잡한 비즈니스 로직을 구현하기에 적합합니다. RESTful API 개발에 최적화되어 있으며, 다양한 확장 라이브러리를 통해 필요한 기능을 쉽게 추가할 수 있습니다.

**데이터베이스**: MySQL 8.0+
MySQL은 안정성과 성능이 검증된 관계형 데이터베이스입니다. JSON 데이터 타입 지원으로 유연한 데이터 구조 설계가 가능하며, 복잡한 집계 쿼리 성능이 우수합니다.

**ORM**: SQLAlchemy 2.0+
SQLAlchemy는 Python의 대표적인 ORM으로, 복잡한 데이터베이스 관계를 효율적으로 관리할 수 있습니다. 쿼리 최적화와 데이터베이스 마이그레이션 기능을 제공합니다.

**캐싱**: Redis 7.0+
Redis는 고성능 인메모리 데이터 저장소로, API 응답 캐싱과 세션 관리에 활용합니다. 특히 대시보드 데이터와 같이 자주 조회되는 집계 정보의 캐싱에 효과적입니다.

**인증**: JWT (PyJWT)
JWT는 stateless한 인증 방식으로, 확장성이 뛰어나고 마이크로서비스 아키텍처에 적합합니다. 토큰에 사용자 권한 정보를 포함하여 효율적인 권한 관리가 가능합니다.

#### 프론트엔드 기술 스택

**프레임워크**: React 18+ with TypeScript
React는 컴포넌트 기반 아키텍처로 복잡한 ERP 인터페이스를 효율적으로 구성할 수 있습니다. TypeScript를 함께 사용하여 타입 안정성을 확보하고 개발 생산성을 향상시킵니다.

**상태 관리**: Redux Toolkit + RTK Query
Redux Toolkit은 상태 관리를 단순화하고, RTK Query는 API 호출과 캐싱을 자동화합니다. 복잡한 ERP 데이터의 상태 관리에 적합합니다.

**UI 라이브러리**: Material-UI (MUI) 5+
Material-UI는 Google의 Material Design을 기반으로 한 완성도 높은 UI 컴포넌트를 제공합니다. 데이터 테이블, 차트, 폼 등 ERP에 필요한 모든 컴포넌트를 포함합니다.

**데이터 그리드**: AG-Grid Community/Enterprise
AG-Grid는 대용량 데이터 처리에 최적화된 데이터 그리드 라이브러리입니다. 엑셀과 유사한 사용자 경험을 제공하며, 실시간 편집, 필터링, 정렬 기능을 지원합니다.

**차트**: Chart.js 4+ with react-chartjs-2
Chart.js는 다양한 차트 타입을 지원하는 가벼운 차트 라이브러리입니다. 대시보드의 시각화 요구사항을 충족할 수 있습니다.

#### 인프라 및 배포

**컨테이너화**: Docker + Docker Compose
Docker를 사용하여 애플리케이션을 컨테이너화하고, Docker Compose로 개발 환경을 구성합니다. 이를 통해 환경 일관성을 보장하고 배포를 단순화합니다.

**웹 서버**: Nginx
Nginx를 리버스 프록시로 사용하여 정적 파일 서빙과 로드 밸런싱을 처리합니다. SSL 터미네이션과 압축 기능도 함께 제공합니다.

**프로세스 관리**: Gunicorn + Supervisor
Gunicorn은 Python WSGI HTTP 서버로 Flask 애플리케이션을 운영 환경에서 실행합니다. Supervisor를 통해 프로세스 모니터링과 자동 재시작을 관리합니다.

**모니터링**: Prometheus + Grafana
Prometheus로 시스템 메트릭을 수집하고, Grafana로 시각화합니다. API 응답 시간, 데이터베이스 성능, 시스템 리소스 사용량 등을 모니터링합니다.

### 데이터 마이그레이션 전략

#### 기존 엑셀 데이터 분석 및 정제

현재 엑셀 파일에 저장된 데이터를 새로운 데이터베이스 스키마로 마이그레이션하는 것은 매우 중요한 과정입니다. 데이터 품질을 보장하고 정보 손실을 방지하기 위해 다음과 같은 단계적 접근을 권장합니다.

**데이터 품질 분석**

먼저 기존 엑셀 데이터의 품질을 철저히 분석합니다. 다음과 같은 항목들을 점검합니다:

- 중복 데이터 식별 및 제거 방안
- 누락된 필수 데이터 식별
- 데이터 형식 불일치 (날짜, 숫자 형식 등)
- 비정규화된 데이터 구조 정규화
- 계산 오류 검증 및 수정

**데이터 매핑 및 변환 규칙**

엑셀의 컬럼과 새로운 데이터베이스 스키마 간의 매핑 규칙을 정의합니다. 예를 들어:

```python
EXCEL_TO_DB_MAPPING = {
    'activations': {
        '대리점': 'dealer_name',
        '통신사': 'carrier',
        '개통방식': 'activation_type',
        '모델명': 'model_name',
        '개통일': 'activation_date',
        '고객명': 'customer_name',
        '개통번호': 'customer_phone',
        '액면/셋팅가': 'face_value',
        '구두1': 'verbal1',
        '구두2': 'verbal2',
        # ... 추가 매핑
    }
}
```

**단계적 마이그레이션**

데이터 마이그레이션은 다음과 같은 단계로 진행합니다:

1. **테스트 환경 마이그레이션**: 소량의 샘플 데이터로 마이그레이션 스크립트를 테스트
2. **데이터 검증**: 마이그레이션된 데이터의 정확성을 원본과 비교 검증
3. **점진적 마이그레이션**: 월별 또는 대리점별로 단계적 마이그레이션 수행
4. **병렬 운영**: 일정 기간 기존 엑셀과 새 시스템을 병렬로 운영하여 안정성 확보
5. **완전 전환**: 검증 완료 후 새 시스템으로 완전 전환

#### 데이터 무결성 보장

마이그레이션 과정에서 데이터 무결성을 보장하기 위해 다음과 같은 검증 절차를 수행합니다:

**수치 검증**

모든 금액 관련 데이터의 합계를 원본과 비교하여 일치하는지 확인합니다. 특히 정산금, 마진 등의 계산 결과가 정확한지 검증합니다.

**관계 무결성 검증**

외래 키 관계가 올바르게 설정되었는지 확인합니다. 예를 들어, 환수 데이터가 올바른 개통 건과 연결되어 있는지 검증합니다.

**비즈니스 규칙 검증**

비즈니스 로직에 맞지 않는 데이터가 있는지 확인합니다. 예를 들어, 음수 정산금이나 미래 날짜의 개통 건 등을 식별합니다.

### 사용자 교육 및 변화 관리

#### 단계별 사용자 교육

새로운 시스템의 성공적인 도입을 위해서는 체계적인 사용자 교육이 필수입니다.

**기초 교육 (1주차)**

- 새로운 시스템의 개요 및 장점
- 기본 로그인 및 네비게이션
- 권한 체계 이해
- 기본 데이터 조회 방법

**기능별 심화 교육 (2-3주차)**

- 개통 데이터 입력 및 수정
- 지출 관리 기능 활용
- 환수 처리 절차
- 급여 관리 기능
- 기본 리포트 생성

**고급 기능 교육 (4주차)**

- 대시보드 활용법
- 고급 필터링 및 검색
- 데이터 내보내기
- 월별 정산 프로세스
- 문제 해결 및 지원 요청

#### 변화 관리 전략

**점진적 전환**

기존 엑셀 기반 프로세스에서 새로운 시스템으로의 전환은 점진적으로 진행합니다. 처음에는 새 시스템을 보조 도구로 활용하다가 점차 주요 업무 도구로 전환합니다.

**슈퍼 유저 양성**

각 대리점에서 새 시스템에 능숙한 슈퍼 유저를 양성하여 동료들을 지원할 수 있도록 합니다. 이들은 시스템 피드백 수집과 개선 제안의 창구 역할도 수행합니다.

**지속적인 지원**

시스템 도입 초기에는 집중적인 지원을 제공합니다. 헬프데스크 운영, FAQ 문서 제공, 실시간 채팅 지원 등을 통해 사용자들이 새 시스템에 빠르게 적응할 수 있도록 돕습니다.

### 성능 최적화 및 확장성

#### 데이터베이스 최적화

**인덱스 전략**

자주 사용되는 쿼리 패턴을 분석하여 최적의 인덱스를 설계합니다. 특히 다음과 같은 복합 인덱스를 고려합니다:

- `(dealer_code, activation_date)`: 대리점별 기간 조회
- `(activation_date, carrier)`: 날짜별 통신사 조회
- `(customer_phone, activation_date)`: 고객별 개통 이력 조회

**쿼리 최적화**

복잡한 집계 쿼리의 성능을 향상시키기 위해 다음과 같은 기법을 적용합니다:

- 구체화된 뷰(Materialized View) 활용
- 파티셔닝을 통한 대용량 테이블 관리
- 읽기 전용 복제본을 통한 조회 성능 향상

**캐싱 전략**

자주 조회되는 데이터에 대해 다층 캐싱 전략을 적용합니다:

- **L1 캐시**: 애플리케이션 메모리 캐시 (5분)
- **L2 캐시**: Redis 캐시 (30분)
- **L3 캐시**: 데이터베이스 쿼리 캐시

#### API 성능 최적화

**응답 시간 최적화**

모든 API 엔드포인트의 응답 시간을 모니터링하고 최적화합니다. 목표 응답 시간은 다음과 같습니다:

- 단순 조회: 100ms 이하
- 복잡한 집계: 500ms 이하
- 대량 데이터 처리: 2초 이하

**비동기 처리**

시간이 오래 걸리는 작업은 비동기로 처리합니다:

- 월별 정산 생성
- 대량 데이터 가져오기/내보내기
- 복잡한 리포트 생성

**페이지네이션 최적화**

대용량 데이터 조회 시 효율적인 페이지네이션을 구현합니다. 커서 기반 페이지네이션을 사용하여 일관된 성능을 보장합니다.

#### 확장성 고려사항

**수평 확장**

시스템 부하 증가에 대비하여 수평 확장이 가능한 아키텍처를 설계합니다:

- 로드 밸런서를 통한 API 서버 확장
- 데이터베이스 읽기 복제본 추가
- 마이크로서비스 분리 준비

**모니터링 및 알림**

시스템 성능과 안정성을 지속적으로 모니터링합니다:

- API 응답 시간 모니터링
- 데이터베이스 성능 지표 추적
- 시스템 리소스 사용량 모니터링
- 오류율 및 가용성 추적

### 보안 및 컴플라이언스

#### 데이터 보안

**개인정보 보호**

고객의 개인정보(이름, 전화번호, 생년월일 등)는 암호화하여 저장하고, 접근 권한을 엄격히 관리합니다. GDPR 및 개인정보보호법 요구사항을 준수합니다.

**데이터 접근 제어**

역할 기반 접근 제어(RBAC)를 구현하여 사용자별로 적절한 데이터에만 접근할 수 있도록 합니다. 모든 데이터 접근은 로그로 기록하여 감사 추적이 가능하도록 합니다.

**데이터 백업 및 복구**

정기적인 데이터 백업과 재해 복구 계획을 수립합니다:

- 일일 자동 백업
- 주간 전체 백업
- 월간 오프사이트 백업
- 복구 테스트 정기 수행

#### 시스템 보안

**네트워크 보안**

- HTTPS 강제 사용
- API 레이트 리미팅
- DDoS 방어 시스템
- 방화벽 및 침입 탐지 시스템

**애플리케이션 보안**

- SQL 인젝션 방어
- XSS 공격 방어
- CSRF 토큰 사용
- 입력 데이터 검증 및 살균

### 유지보수 및 지원

#### 지속적인 개선

**사용자 피드백 수집**

정기적으로 사용자 피드백을 수집하고 분석하여 시스템을 개선합니다. 사용자 만족도 조사, 기능 요청 수집, 버그 리포트 처리 등을 체계적으로 관리합니다.

**성능 모니터링**

시스템 성능을 지속적으로 모니터링하고 최적화합니다. 병목 지점을 식별하고 개선하여 사용자 경험을 향상시킵니다.

**기능 확장**

비즈니스 요구사항 변화에 따라 새로운 기능을 추가합니다. 모듈화된 아키텍처를 통해 기존 시스템에 영향을 주지 않고 새 기능을 추가할 수 있습니다.

#### 기술 지원

**24/7 모니터링**

시스템의 안정성을 보장하기 위해 24시간 모니터링 체계를 구축합니다. 장애 발생 시 즉시 알림을 받고 신속하게 대응할 수 있는 체계를 마련합니다.

**정기 유지보수**

정기적인 시스템 유지보수를 수행합니다:

- 보안 패치 적용
- 데이터베이스 최적화
- 로그 정리 및 아카이빙
- 백업 시스템 점검

**문서화 및 지식 관리**

시스템 운영에 필요한 모든 문서를 체계적으로 관리합니다:

- API 문서
- 운영 매뉴얼
- 장애 대응 가이드
- 사용자 매뉴얼

이러한 종합적인 구현 방안을 통해 현재의 엑셀 기반 업무 프로세스를 현대적이고 효율적인 웹 기반 ERP 시스템으로 성공적으로 전환할 수 있습니다. 단계적 접근과 지속적인 개선을 통해 시스템의 안정성과 사용자 만족도를 모두 확보할 수 있을 것입니다.

